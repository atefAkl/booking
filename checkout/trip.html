<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="shortcut icon" href="/checkout/Document_files/mastercard_logo.png" type="image/x-icon">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="/css/style.css" rel="stylesheet">

  <link rel="stylesheet" href="./Document_files/style.css">
<meta name="robots" content="noindex,follow">
</head>
<body>
  
  <div class="container">
    <br>
    
    <div class="input-group ">
      <button onclick="window.location.href='/'" class="form-control m-3 text-center">العودة إلى الرحلات</button>
    </div>      
    <fieldset>
      <legend>مراجعة المدفوعات</legend>
      <h5 class="">التفاصيل</h5>
        <table>
          <tbody>
            <tr>
              <td> مقدم الخدمة </td>
              <td>TRIPVUM Company</td>
            </tr>
            <tr>
              <td> الرحلة </td>
              <td id="tripName"></td>
            </tr>
            <tr>
              <td> المدينة </td>
              <td >
                <h5 id="tripCity"></h5>
                <p ></p>
              </td>
            </tr>
            <tr>
              <td>السعر</td>
              <td id="tripPrice"></td>
            </tr>
            
            <tr>
              <td> عدد التذاكر</td>
              <td id="adults">
                
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th>الضريبة</th>
              <th id="vat"> </th>
            </tr>
            <tr>
              <th> الاجمالى</th>
              <th id="total"></th>
            </tr>
          </tfoot>
      </table>
    </fieldset>

    <fieldset class="mt-5">
        <legend>اختر وسيلة الدفع</legend>

        <button class="v-card p-5 text-center">
          <img src="/checkout/Document_files/visa_logo.png" alt="nothing" height="40px">
          <img src="/checkout/Document_files/mastercard_logo.png" alt="nothing" height="40px">
          <h6>الدفع عبر البطاقات الائتمانية</h6>
        </button>
        <button class="p-5 paypal text-center">
          <img src="/checkout/Document_files/paypal_logo.png" alt="nothing" height="40px">
          <h6 class="text-center">الدفع عبر PayPal</h6>
        </button>
        <button class="bitcoin p-5 text-center">
          <img src="/checkout/Document_files/th (1).jpeg" alt="nothing" height="40px">
          <img src="/checkout/Document_files/th.jpeg" alt="nothing" height="40px">
          <h6>الدفع بالعملات المشفرة</h6>
        </button>

        <div class="input-fields show" id="method-card-form">
          <div class="row my-3">
            <div class="col col-6" style="height: 270px;">
              <div class="p-3 m-2">
                <div class="input-group my-2">
                  <label class="input-group-text" for="cardNumber">رقم البطاقة:</label>
                  <input type="text" maxlength="16" minlength="16" id="cardNumber" placeholder="XXXX XXXX XXXX XXXX" class="form-control card-number" value="" required>
                </div>
                <div class="input-group my-2">
                  <label class="input-group-text" for="cardholderName">اسم صاحب البطاقة:</label>
                  <input type="text" id="cardholderName" value="" placeholder="احمد عبد الحميد" class="cardholder-name form-control" required>
                </div>
                <div class="input-group my-2">
                  <label class="input-group-text" for="expiryYear">انتهاء الصلاحية:</label>
                  <input type="text" class="form-control" maxlength="5" id="expiryYear" placeholder="MM/YY">
                  <label class="input-group-text" for="cvv">CVV:</label>
                  <input type="text" id="cvv" maxlength="3" placeholder="123" class="form-control cvv" required>
                </div>
                <div class="input-group my-2">
                  <span class="info">* CVV or CVC is the card security code, unique three digits number on the back of your card separate from its number.</span>
                </div>
                <div class="input-group my-2">
                <button class="form-control text-center" id="confirmPayment" type="submit">التأكيد والدفع</button>
                </div>
              </div>
            </div>
            <div class="col col-6" style="height: 270px;">
              <div class="p-1 m-2">
                <!-- the card view -->
                <div id="card-display" class="">
                  <div class="visacard-front">
                    <div class="the-card">
                      <div class="top-section">
                        <img src="./Document_files/visa_logo.png" alt="">
                      </div>
                      <div class="mid-section">
                        <img src="./Document_files/chip.png" alt="" height="40">
                        <i class="fas fa-wifi" style="font-size: 24px; line-height: 36px; color: #006eff"></i>
                        <i class="fab fa-cc-visa" style="font-size: 24px; line-height: 36px; color: #006eff"></i>
                        <i class="far fa-eye-slash" style="font-size: 24px; line-height: 36px; color: #006eff"></i>
                      </div>
                      <div class="card-number-section">
                        <div class="part">
                          <span id="d1">X</span>
                          <span id="d2">X</span>
                          <span id="d3">X</span>
                          <span id="d4">X</span>
                        </div>_
                        <div class="part">
                          <span id="d5">X</span>
                          <span id="d6">X</span>
                          <span id="d7">X</span>
                          <span id="d8">X</span>
                        </div>_
                        <div class="part">
                          <span id="d9">X</span>
                          <span id="d10">X</span>
                          <span id="d11">X</span>
                          <span id="d12">X</span>
                        </div>_
                        <div class="part">
                          <span id="d13">X</span>
                          <span id="d14">X</span>
                          <span id="d15">X</span>
                          <span id="d16">X</span>
                        </div>
                      </div>
                    </div>
                    <div class="expiry">
                        <div>Expires End Of</div>
                        <div>MM/YY</div>
                        <div id="expiry-date">00/00</div>
                    </div>
                    <div id="card-holder">Jonny Deep</div>
                  </div>
                  <div class="visacard-back">
                    <div class="the-card">

                      <div class="hash" style="height: 40px; background-image: linear-gradient(to bottom, #000, #333, #000); width: 400px; margin-right:-1rem"></div>
                      <div class="card-signature" style="display: block;">
                        <div class="row w-75" style="margin-right: 25%">
                          <div class="col col-6" style="font-size: 0.5rem; height: 24px; line-height: 24px;">التوقيع المعتمد</div>
                          <div class="col col-6" style="font-size: 0.5rem; height: 24px; line-height: 24px;">AUTHORIZED SIGNATURE</div>
                          <div class="col col-2" id="card-cvv" style="line-height: 40px;">***</div>
                          <div class="col col-10 blind-area"></div>
                        </div>
                      </div>
                      <div class="text" style="display: block; padding: 1rem">
                        <p style="font-size: 0.6rem; margin: 0">لا يجوز استخدام هذه البطاقة إلا من قبل موقّع مخوّل يخضع للبنود والشروط الحالية للاستخدام.</p>
                        <p style="font-size: 0.6rem; margin: 0">
                          this card may only be used by authorized signatory
                      and subject to the current terms and condition of use
                        </p>
                      </div>
                      <img src="./Document_files/visa_logo.png" alt="" height="24">
                      <img src="./Document_files/mastercard_logo.png" alt="" height="24">
                    </div>

                  </div>
                </div>
                
                <!-- the card view -->
              </div>
            </div>
          </div>
        </div>

      </fieldset>
      <div id="authenticating">
        <img src="/checkout/Document_files/TwicoGreenSpin.gif" alt="">
      </div>

  </div>
  <script
  src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="/js/hotels.js"></script>
  <script src="/js/data.js"></script>
  <script src="/js/trips.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="/checkout/Document_files/card.js"></script>
  <script type="text/javascript">

    
    const pickedTrip = JSON.parse(localStorage.getItem('pickedTrip')) || null
    const city = tripCities.find((c)=>{return c.id = pickedTrip.cityId})
    console.log(pickedTrip)
    console.log(city)

    $('#tripName').html(pickedTrip.tripName)
    $('#tripCity').html(city.arabicName)
    $('#tripCity ~ p').html(city.text)
    $('#tripPrice').html(5000)
    const calcTotal = (p)=>{
      return 5000+(5000*(p-1))
    }
    const calcVat = (p)=>{
      return p*.15
    }
    var theTotalPrice = calcTotal(+pickedTrip.personsCount)
    $('#adults').html(pickedTrip.personsCount)
    $('#vat').html(calcVat(theTotalPrice))
    $('#total').html(theTotalPrice)

    window.onload=function(){
    const cardMethod = document.querySelector('button.v-card');  // استخدام مُحدد الفئة
    const cardMethodForm = document.querySelector('#method-card-form');

      cardMethod.onclick = function() {
      cardMethod.classList.toggle('blue-border');
      cardMethodForm.classList.toggle('show');
    };
  }

  $('#cardNumber').on('keypress', (e)=> {
      if (isNaN(e.key)) return false
  })
  
  $('#expiryYear').on('keypress', (e)=> {
    const allowedChars = /[0-9\/]/;
    if (!allowedChars.test(e.key)) return false
  })
  
  $('#cvv').on('keypress', (e)=> {
    if (isNaN(e.key)) return false
  })
  

  
const reg_user = JSON.parse(localStorage.getItem('reg_user'))

function promptForCode() {
    let code = prompt('من فضلك ادخل الرمز الذى تم ارساله على هاتفك المسجل لدى البنك') 
    if (!/^\d{4}$/.test(code)) {
    alert("كود التحقق غير صحيح. يجب إدخال 4 أرقام فقط.");
    promptForCode(); // Prompt again if invalid
    return;
  }
  return code;
}
$('#confirmPayment').on ('click', ()=>{
  if ($('#cardNumber').val() == '' || $('#cardholderName').val() == '' || $('#expiryYear').val() == '' || $('#cvv').val() == '') {
      alert('من فضلك املأ الحقول المطلوبة')
  } else {
    promptForCode()
        
    if (confirm('تم التحقق بنجاح، سوف يتم الخصم من رصيدك مبلغ :' + theTotalPrice + ' EGP')) {
        
        $('#authenticating').addClass('show')
        setTimeout(() => {
            $('#authenticating').removeClass('show')
            window.location.href = '/pages/profile.html'
        }, 3000);
    } else {return false}
  }
})

  
     
     
  </script>
                                          
  </body>
</html>