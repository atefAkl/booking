<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TRIPVUM</title>
    <link rel="shortcut icon" href="../images/favicon.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/all.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/booking.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      const urlParams = new URLSearchParams(window.location.search);
      
    </script>
  </head>
  <body dir="rtl">
    <header>
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" data-bs-toggle="tooltip" title="ูููุน ุญุฌุฒ ุฑุญูุงุช ุงูุทูุฑุงู ุงูุฏุงุฎูู" href="/index.html">
            <img class="d-block" src="../images/icon.png" height="40" alt="">
            <img class="d-block" src="../images/tripvum.png" height="12" alt="">
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav m-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/index.html">
                  <i class="fa fa-home"></i> &nbsp; ุงูุฑุฆูุณูุฉ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-clipboard-check"></i> &nbsp; ุงูุญุฌุฒ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-suitcase-rolling"></i> &nbsp; ุฑุญูุงุช</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-hotel"></i>  &nbsp;  ุฅูุงูุฉ</a>
              </li><li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-plane"></i>  &nbsp;  ุทูุฑุงู</a>
              </li><li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-star-half-alt"></i> &nbsp; ุชููููุงุช</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <i class="fas fa-id-card"></i> &nbsp; ุงุชุตู ุจูุง</a>
              </li>
            </ul>
            <!-- Button trigger modal -->
            <div class="user">
              <div class="user-buttons">
                <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginFormModal">
                  ุงูุฏุฎูู
                </button>
                <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">
                  ุงูุชุณุฌูู
                </button>
              </div>
              <div id="user-menu" class="user-menu hidden">
                <button class="btn text-light "> &nbsp; <i class="fa fa-user"></i>&nbsp; ูุฑุญุจุง  <span class="username"></span></button>
                <ul class="hidden">
                  <li>
                    <a href="/pages/profile.html">ุญุณุงุจ ุดุฎุตู</a>
                  </li>
                  <li>
                      <a href="/pages/favourites.html">ุงูููุถูุฉ</a>
                  </li>
                  <li>
                    <a href="/pages/favourites.html?trips=1">ุฑุญูุงุช</a>
                  </li>
                  <li>
                    <a href="/pages/favourites.html?flights=1">ุทูุฑุงู</a>
                  </li>
                  <li>
                    <a href="/pages/favourites.html?hotels=1">ููุงุฏู</a>
                  </li>
                  <li>
                    <a id="logout">ุฎุฑูุฌ</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </header>


    <section class="booking-header" style="background: url('../images/booking-header.jpeg'); background-size: 100%; background-position: left 30%; height: 200px">

    </section>


    <!-- Booking form -->
    <section id="booking-section" class="w-100">
      <div class="booking  rounded-2 px-5 py-3">
         <nav>
            <div class="nav nav-tabs" id="nav-tab"  role="tablist" style="border: 0">
                <button class="nav-link active" id="nav-booking-tab" data-bs-toggle="tab" data-bs-target="#nav-booking" type="button" role="tab" aria-controls="nav-booking" aria-selected="true">ุญุฌุฒ ุทูุฑุงู</button>
                
                <button class="nav-link" id="nav-trips-tab" data-bs-toggle="tab" data-bs-target="#nav-trips" type="button" role="tab" aria-controls="nav-trips" aria-selected="false">ุงูุฑุญูุงุช</button>
                <button class="nav-link" id="nav-hotels-tab" data-bs-toggle="tab" data-bs-target="#nav-hotels" type="button" role="tab" aria-controls="nav-hotels" aria-selected="false">ุงูููุงุฏู</button>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent" style="background-color: #fff">
            <div class="tab-pane fade show active" id="nav-booking" role="tabpanel" aria-labelledby="nav-booking-tab" tabindex="0">
             
              <form class="px-4 py-3" action="/pages/flights.search.html" method="GET">
                
                <div class="input-group">
                  <input disabled style="background-color: #fff !important;" type="text" class="form-control border-0" value="ุชุงุฑูุฎ ุงูุฑุญูุฉ: ">  
                  <input disabled style="background-color: #fff !important;" type="text" class="form-control border-0" value="ุงูุญุฌุฒ ูู: ">  
                  <input disabled style="background-color: #fff !important;" type="text" class="form-control border-0" value="ุงููุฌูุฉ: ">  
                </div>
                <div class="input-group">
                  <!-- <label for="go" class="input-group-text">ุชุงุฑูุฎ ุงูุฑุญูุฉ</label> -->
                  <input class="form-control" name="go" type="date" id="go" >  
                  <!-- <label for="from" class="input-group-text">ุงูุญุฌุฒ ูู:</label> -->
                  <select class="form-control" name="departure" type="date" id="departure"></select>  
                  <!-- <label for="destination" class="input-group-text">ุงููุฌูุฉ:</label> -->
                  <button class="input-group-text" type="button" id="swap"><i class="fa-solid fa-right-left"></i></button>  
                  
                  <select class="form-control" name="destination" type="date" id="destination"></select>
                  </div>
                <div class="input-group mt-2">
                  <label for="grade" class="input-group-text">ุงูุฏุฑุฌุฉ:</label>
                  
                  <select name="grade" id="grade" class="form-control">
                    <option value="ECO">ุงูุฏุฑุฌุฉ ุงูุงูุชุตุงุฏูุฉ</option>
                    <option value="BC">ุฏุฑุฌุฉ ุงูุงุนูุงู</option>
                    <option value="FC">ุงูุฏุฑุฌุฉ ุงูุฃููู</option>
                  </select>
                  <label for="adult" class="input-group-text">ุงูุจุงูุบูู:</label>
                  <input type="number" name="adult" id="adult" class="form-control" min="1" step="1" value="1">
                  <label for="child" class="input-group-text">ุงูุฃุทูุงู:</label>
                  <input type="number" name="child" id="child" class="form-control" min="0" step="1" value="0">
                  <label for="enfants" class="input-group-text">ุงูุฑุถุน:</label>
                  <input type="number" name="enfants" id="enfants" class="form-control" min="0" step="1" value="0">
                  <button type="submit" id="search_flights" class="input-group-text">ุงูุจุญุซ &nbsp; <i class="fa fa-search"></i></button>
                </div>
              </form>

            </div>
            <div class="tab-pane fade" id="nav-trips" role="tabpanel" aria-labelledby="nav-trips-tab" tabindex="0">
              
              
            </div>
            <div class="tab-pane fade" id="nav-hotels" role="tabpanel" aria-labelledby="nav-hotels-tab" tabindex="0">
            
              <form class="px-4 py-3" action="/pages/hotels.html" method="GET">
                
                <div class="input-group">
                  <input disabled style="background-color: #fff !important;" type="text" class="form-control border-0" value="ุชุงุฑูุฎ ุงููุตูู: ">  
                  <input disabled style="background-color: #fff !important;" type="text" class="form-control border-0" value="ุงููุฏููุฉ: ">  
                    
                </div>
                <div class="input-group">
                  <input class="form-control" name="arrive" type="date" id="arrive" >  
                  <select class="form-control" name="city" id="city"></select>
                  <button class="input-group-text">ุงูุจุญุซ &nbsp; <i class="fa fa-search"></i></button>
                </div>
              </form>
              

            </div>
            
          </div>
        
    </section>


    <section class="flights-list" dir="rtl">
        <div class="container">
            <div id="filters" style="min-height: 100vh; background: #fff;" class="w-75">
                <div class="filters-header">
                  ูุชุงุฆุฌ ุงูุจุญุซ
                  </div>
                  <div id="search-result" class="px-3">

                  </div>
            </div>
            <div id="filters" style="height: 100vh; background: #fff;" class="w-25">
                <div class="filters-header">
                    ููุชุฑุฉ ุงููุชุงุฆุฌ
                </div>
                <div class="filter-contents">

                  <div class="filters-section p-3" >
                    <div class="card">
                      <div class="card-header">
                        <h6>ุงูุชุฑุงูุฒูุช</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-check" dir="rtl">
                          <label class="form-check-label" for="direct">ุฑุญูุงุช ูุจุงุดุฑุฉ</label>
                          <input class="form-check-input" type="radio" role="switch" name="transit" id="direct" checked>
                        </div>
                        <div class="form-check" dir="rtl">
                          <label class="form-check-label" for="single-transit">1 ุชุฑุงูุฒูุช</label>
                          <input class="form-check-input" type="radio" role="switch" name="transit" id="single-transit" >
                        </div>
                        <div class="form-check" dir="rtl">
                          <label class="form-check-label" for="multiple-transit">2+ ุชุฑุงูุฒูุช</label>
                          <input class="form-check-input" type="radio" role="switch" name="transit" id="multiple-transit" >
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="filters-section p-3" >
                    <div class="card">
                      <div class="card-header">
                        <h6>ูุณุงุฆู ุงูุฏูุน</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-check form-switch" dir="rtl">
                          <label class="form-check-label" for="cash">ุงูุฏูุน ุงูููุฏู</label>
                          <input class="form-check-input" type="checkbox" role="switch" id="cash" checked>
                        </div>
                        <div class="form-check form-switch" dir="rtl">
                          <label class="form-check-label" for="visa">ููุฒุง ูุงุฑุฏ</label>
                          <input class="form-check-input" type="checkbox" role="switch" id="visa" checked>
                        </div>
                        <div class="form-check form-switch" dir="rtl">
                          <label class="form-check-label" for="transfer">ุชุญููู ุจููู</label>
                          <input class="form-check-input" type="checkbox" role="switch" id="transfer" checked>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="filters-section p-3" >
                    <div class="card">
                      <div class="card-header">
                        <h6>ุฎูุงุฑุงุช ุงูุฏูุน</h6>
                      </div>
                      <div class="card-body">
                        <div class="form-check" dir="rtl">
                          <label class="form-check-label" for="direct"> ุนุจุฑ TRIPVUM</label>
                          <input class="form-check-input" type="radio" role="switch" name="transit" id="direct" checked>
                        </div>
                        <div class="form-check" dir="rtl">
                          <label class="form-check-label" for="single-transit">ุนุจุฑ ุดุฑูุฉ ุงูุทูุฑุงู</label>
                          <input class="form-check-input" type="radio" role="switch" name="transit" id="single-transit" >
                        </div>
                        
                      </div>
                    </div>
                  </div>

                </div>
            </div>
        </div>


    </section>

    <!-- Modals -->

    <!-- Login Form -->
    <div class="modal fade" id="loginFormModal" tabindex="-1" aria-labelledby="loginFormLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
         
          <div class="modal-header p-1 px-3">
            <h3 class="modal-title" id="loginFormLabel">ุชุณุฌูู ุงูุฏุฎูู</h3>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-2">
              <label for="email" class="input-group-text">ุงุณู ุงููุณุชุฎุฏู: </label>
              <input class="form-control" type="email" id="email">
            </div>
            <div class="input-group mb-2">
              <label for="password" class="input-group-text">ูููุฉ ุงููุฑูุฑ: </label>
              <input class="form-control" type="password" id="password">
            </div>
                    
            <div class="input-group mb-2" dir="rtl">
              <label class="input-group-text" for="">
                <input type="checkbox" id="btn-check" autocomplete="off">
              </label>
            <label class="input-group-text" for="btn-check">ุชุฐูุฑูู</label>

            </div>
            
            <div class="input-group row m-auto">
              <button type="button" class="btn btn-m btn-outline-secondary col-6" data-bs-dismiss="modal">ุงูุบุงุก</button>
              <button type="button" id="submitLogin" class="btn btn-m btn-outline-primary col-6">ุชุณุฌูู ุงูุฏุฎูู</button>
            </div>

          </div>
          <div class="modal-footer py-1 px-3">
            <p>ูุณูุช ูููุฉ ุงููุฑูุฑุ <a href="./reset.password.html">ุงุญุตู ุนูู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ</a></p>
            <p>ููุณ ูุฏูู ุญุณุงุจุ ููููู  
              <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">
                  ุงูุชุณุฌูู
                </button> ูู ุงููููุน.
            </p>
            <p></p>
          </div>
        </div>
        
      </div>
    </div>

    <!-- Register Form -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
         
          <div class="modal-header p-1 px-3">
            <h3 class="modal-title" id="registerModalLabel">ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ</h3>
            <button type="button" class="btn-close text-light" data-bs-dismiss="modal" aria-label="Close"><i class="fa fa-times text-light"></i></button>
          </div>
          <div class="modal-body">
            <div id="register-form">
                <div class="input-group mb-2">
                    <label for="username" class="input-group-text">ุงุณู ุงููุณุชุฎุฏู:</label>
                    <input type="text" id="reg_username" placeholder="ูุญูุฏ ุฃุญูุฏ" class="form-control">
                </div>
                <div class="input-group mb-2">
                    <label for="email" class="input-group-text">ุงูุจุฑูุฏ ุงูุงููุชุฑููู:</label>
                    <input type="email" id="reg_email" placeholder="abcd@website.ext" class="form-control">
                </div>
                <div class="input-group mb-2">
                    <label for="password" class="input-group-text">ูููุฉ ุงููุฑูุฑ:</label>
                    <input type="password" id="reg_password" placeholder="ูููุฉ ุงููุฑูุฑ" class="form-control">
                    <input type="password" id="reg_cPassword" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ" class="form-control">
                </div>
                <div class="input-group row m-auto">
                  <button type="button" class="btn btn-m btn-outline-secondary col-6" data-bs-dismiss="modal">ุงูุบุงุก</button>
                  <button type="submit" id="submit-register" class="btn btn-m btn-outline-primary col-6"><span class="ss">ุงูุชุณุฌูู</span></button>
                </div>
            </div>

          </div>
          <div class="modal-footer py-1 px-3">
            <p>ูุฏูู ุญุณุงุจ ูุณุฌู ุจุงููุนูุ &nbsp; 
              <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginFormModal">
                ุชุณุฌูู ุงูุฏุฎูู
              </button></p>
            <p></p>
          </div>
        </div>
      </div>
    </div>

    
    <button type="button" class="btn btn-primary hidden" id="liveToastBtn">Show live toast</button>

    <!-- alerts -->
    <div class="toast-container position-fixed bottom-0 start-0 p-3">
      <div id="liveToast"  style="z-index: 99999;" class="toast registerError" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <span class="rounded me-2 bg-primary"></span>
          <strong class="me-auto">ูููุน TRIPVUM</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>

        <div class="toast-body">
          <div id="errMessage">
            Lorem ipsum, dolor sit amet consectetur adipisicing elit. Vitae, obcaecati quos. Consequatur.
          </div>
          <!-- <div class="mt-2 pt-2 border-top">
            <button type="button" class="btn btn-primary btn-sm">Take action</button>
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="toast">Close</button>
          </div> -->
        </div>
      </div>
    </div>



    <div class="result-info-section" id="info-section">
      <div class="container">
        <div class="card mt-5 w-50 m-auto">
          <div class="card-header">
            <h5>ูุนูููุงุช ุงูุฑุญูุฉ</h5>
            
            <span id="close-result-info" class="close" data-bs-dismiss="#info-section"><i class="fa fa-times"></i></span>
          </div>
          <div class="card-body">
            <table id="flight-info">
              <tr>
                <th>ุชุงุฑูุฎ ุงูุญุฌุฒ:</th>
                <td id="bookingDate"></td>
              </tr>
              <tr>
                <th >ูู:</th>
                <td id="fromAirport"></td>
              </tr>
              <tr>
                <th>ุฅูู:</th>
                <td id="toAirport">ุฅูู:</td>
              </tr>
              <tr>
                <th>ููุช ุงูุงููุงุน:</th>
                <td id="departureTime"></td>
              </tr>
              <tr>
                <th>ููุช ุงููุตูู:</th>
                <td id="arrivalTime">ููุช ุงููุตูู:</td>
              </tr>
              <tr>
                <th>ูุฏุฉ ุงูุฑุญูุฉ:</th>
                <td id="flightDuration">ูุฏุฉ ุงูุฑุญูุฉ:</td>
              </tr>
              <tr>
                <th>ุงูุฏุฑุฌุฉ:</th>
                <td id="flightGrade">ุงูุฏุฑุฌุฉ:</td>
              </tr>
              <tr>
                <th rowspan="3">ุงูุฑูุงุจ:</th>
                <td><span id="adultCount"></span> ุจุงูุบูู </td>
              </tr>
              <tr>
                <td><span id="childrenCount"></span> ุฃุทูุงู </td>
              </tr>
              <tr>
                <td><span id="babiesCount"></span> ุฑุถุน </td>
              </tr>
              <tr>
                <th>ุงููุงูู:</th>
                <td id="carrierName">ุงููุงูู:</td>
              </tr>
              <tr>
                <th>ุงูุณุนุฑ ุงูููู:</th>
                <td id="totalPrice"></td>
              </tr>
            </table>
          </div>
          <div class="card-footer">
            <div class="input-group" dir="rtl">
              <label class="input-group-text"><a href="/checkout/flights.html">ุงููุงู ุงูุญุฌุฒ</a></label>
              <label class="input-group-text"><a href="#">ุงูุฐูุงุจ ุงูู ูููุน ูุฒูุฏ ุงูุฎุฏูุฉ</a></label>
              <label class="input-group-text"><a href="">ุงูุจุญุซ ุนู ุฑุญูุฉ ุฃุฎุฑู</a></label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script src="../js/hotels.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/register.js"></script>
    <script src="../js/data.js"></script>

    <script>

      if(urlParams.get('go') == '') {
        if (confirm ('ูู ูุถูู ุงุฎุชุฑ ููุนุฏ ููุฑุญูุฉ ููุชููู ูู ุงูุจุญุซ')){
          $('#go').focus()
        } else {
          goTo('/')
        }
      }

      const fromAirport = airports.find((ap)=>{return ap.id==urlParams.get('departure')})

      $('#go').val(urlParams.get('go'))
      $('#adult').val(urlParams.get('adult'))
      $('#child').val(urlParams.get('child'))
      $('#enfants').val(urlParams.get('enfants'))

      $('#grade').val(urlParams.get('grade'))
      airports.forEach ((ap)=>{
        $('#departure').append(`<option ${urlParams.get('departure') == ap.id ? 'selected' : ''} value="${ap.id}">${ap.name}</option>`)
        $('#destination').append(`<option ${urlParams.get('destination') == ap.id ? 'selected' : ''} value="${ap.id}">${ap.name}</option>`)

      })


      const departure = airports.find((ap)=>ap.id == urlParams.get('departure'))
      const destination = airports.find((ap)=>ap.id == urlParams.get('destination'))
      const departure_date = urlParams.get('go')
      const found_fights = []

      airlines.forEach((al, i)=>{
        found_fights.push({
          flight_id: ++i,
          departure: departure,
          destination: destination,
          departure_date: departure_date
        })
      })
      console.log(departure)

      const indexes = []
      for (let i = 0; i<100; i++){
        let index = Math.floor(Math.random()*100)
        indexes.push(index)
      }

      const now = new Date()
      
      function getDayName(date){
        return date.getDay()
      }

      // ููุชุฑุฉ ุงูุจูุงูุงุช
      //flights.sort((a, b) => a.price - b.price);


      // ุชูููุฏ ููู ุนุดูุงุฆูุฉ ูุนุฏุฏ ููุงูุน ุงูุจุญุซ ุงูุชู ุชู ุฌูุจ ุงูุจูุงูุงุช ูููุง
      

      // ุชูููุฏ ูุญุทุงุช ุงูุชููู ููุฑุญูุงุช ุบูุฑ ุงููุจุงุดุฑุฉ
      const steps = (stops) =>{
        let rs = ''
        if (stops.length > 0) {
        stops.forEach(stop=>{
          rs += `<span class="stop" data-stop="${stop}"></span>`
        })
      } else {
        rs=`<span class="direct">ุฑุญูุฉ ูุจุงุดุฑุฉ</span>`
      }
        return rs;
      }

      // ุชุฑุชูุจ ุงููุตูููุฉ ุจุดูู ุนุดูุงุฆู
      function shuffleArray(array) {
        // Create a copy of the array to avoid modifying the original
        const shuffledArray = [...array];
        // Use the Fisher-Yates shuffle algorithm
        for (let i = shuffledArray.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1)); // Random index between 0 and i (inclusive)
          [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]]; // Swap elements
        }
        return shuffledArray;
      }
      const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

      ////////////////////////////////////////


      const rendered_results = (flights) => {
        const res = flights.map ((flight, i)=>{
          const index = randomNumber(0, airlines.length)
          const alp = airlines[index]
        const weekDay = new Date(departure_date)
        const grade = $('#grade').val();
        
        const flightPrice = pricing[getDayName(weekDay)][grade]*flight.carrier.ratio
        
        const stops = flight.stops.map((stop)=>{ return '<span class="stop" data-stop="'+stop+'"></span>'})
        return `
        
          <div class="result">
            <a class="result-info">
              <div class="row result-wrapper">
                <div class="col col-3" style="border-left: 1px solid #ccc">
                  <div class="airline-provider p-3 ">
                    <p class="text-center" >
                      <img class="d-block m-auto" src="${flight.carrier['logo']}" alt="" height="50" /></p>
                    <p class="provider-name">${flight.carrier['name']}</p>
                    <button 
                      data-carrier-id="${flight.carrier['name']}" 
                      class="flight-more-info btn btn-sm px-3 btn-outline-primary m-0"
                      data-departure-time="${flight['departureTime']}"
                      data-flight-duration="${flight.duration[0]} ุณุ ${flight.duration[1]} ุฏ"
                      data-arrival-time="${flight['arrivalTime']}"
                      data-flight-price="${flightPrice.toFixed(2)}"
                      data-flight-index="${i}"
                      >ุนุฑุถ ุงููุฒูุฏ </button>
                  </div>
                </div>
                <div class="col col-6 ">
                  <div class="flight-details p-3 ">
                    <div class="line"></div>
                    <div class="timing">
                      <span class="start" data-time="${flight['departureTime']}" data-airport="${departure.IATA}" title="${departure.name}"></span>
                      <span class="stops text-center" data-period="๐ ${flight.duration[0]} ุณุ ${flight.duration[1]} ุฏ">
                        ${steps(flight.stops)}
                      </span>
                      <span class="end" data-time="${flight['arrivalTime']}" data-airport="${destination.IATA}" title="${destination.name}"></span>
                    </div>
                  </div>
                </div>
                <div class="pricing col col-3 p-0">
                  <div class="flight-pricing text-center p-0">
                    <button class="btn">ููุตุญ ุจูุง</button>
                    <p class=" results-from-websites my-0 py-0 text-center">
                      <small>ุงููุชุงุฆุฌ ูู ${randomNumber(1, 10)} ููุงูุน</small></p>
                    <p class="price text-center">
                      <span class="amount fw-bold py-0 my-0 fs-3">
                       
                        ${flightPrice.toFixed(2)}
                      </span>
                      ุฌ ู
                    </p>
                    <p class="price-info py-0 my-0 text-center">ูููุฑุฏ ุดุงููุฉ ุงูุถุฑูุจุฉ</p>
                  </div>
                </div>
              </div>
            </a>
          </div>
        `
      })
      return res;
    }

    const flights = generateFlights(randomNumber(10, 15));

      $('#search-result').html(rendered_results(flights))


      function htmlEl(name, text, attr) {
        let el = document.createElement(name)
        el.innerHTML = text
        for (prop in attr) {
          el.setAttribute(prop, attr[prop])
        }
        return el
      }

      const regUser = JSON.parse(localStorage.getItem('reg_user'))


      $('.flight-more-info').on('click', function (e) {
        $('body').addClass('freeze');
        const selectedFlight = {
          user: regUser.email,
          index: e.target.getAttribute('data-flight-index'),
          adultCount: +urlParams.get('adult'),
          childrenCount: +urlParams.get('child'),
          babiesCount: +urlParams.get('enfants'),
          flightGrade: urlParams.get('grade'),
          bookingDate: urlParams.get('go'),
          fromAirport: airports.find((al)=> {return al.id == urlParams.get('departure')}).name,
          toAirport: airports.find((al)=> {return al.id == urlParams.get('destination')}).name,
          
          carrierName: e.target.getAttribute('data-carrier-id'),
          flightDuration: e.target.getAttribute('data-flight-duration'),
          departureTime: e.target.getAttribute('data-departure-time'),
          arrivalTime: e.target.getAttribute('data-arrival-time'),
          price: +e.target.getAttribute('data-flight-price'),
          
        }
        for (prop in selectedFlight){
          if ($('#'+prop) != undefined) {
            $('#'+prop).html(selectedFlight[prop])
          }
        }
        selectedFlight.totalPrice= (selectedFlight.adultCount*selectedFlight.price) + (selectedFlight.babiesCount*selectedFlight.price*0.8) + (selectedFlight.childrenCount*selectedFlight.price*0.92)
        $('#totalPrice').html(selectedFlight.totalPrice)
        
        localStorage.setItem('pickedFlight', JSON.stringify(selectedFlight))
        $('.result-info-section').addClass('show')
      })
    </script>


  </body>
</html>